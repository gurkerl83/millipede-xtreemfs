#!/bin/bash

check_xtreemfs() {
    if [ -z "$XTREEMFS" ]; then
        if [ -d AL -a -d java ]; then
            echo "Looks like you are in an XtreemFS base directory..."
            XTREEMFS=`pwd`
        elif [ -d ../AL -a -d ../java ]; then
            echo "XTREEMFS base could be the parent directory..."
            XTREEMFS=`pwd`/..
        fi
    fi
    if [ ! -e "$XTREEMFS/src/servers/dist/XtreemFS.jar" -a ! -d "$XTREEMFS/src/servers/lib" -a ! -f "/usr/share/java/XtreemFS.jar" ];
    then
        echo "XtreemFS jar could not be found!"
        exit 1
    fi
}

check_java() {
    if [ -z "$JAVA_HOME" -a ! -f "/usr/bin/java" ]; then
        echo "\$JAVA_HOME not set, JDK/JRE 1.6 required"
        exit 1
    fi

    if [ -z "$JAVA_HOME" ]; then
        JAVA_HOME=/usr
    fi

    JVERS=`$JAVA_HOME/bin/java -version 2>&1 | grep "java version" | \
       cut -d " " -f 3`
    perl -e " exit 1 if ($JVERS < \"1.6.0\");"
    if [ $? -eq 1 ]; then
       echo "Java version is $JVERS. You need JAVA 1.6!!!"
       exit 1
    fi

    #echo "Java version $JVERS found under $JAVA_HOME"
}


check_xtreemfs
check_java

exec $JAVA_HOME/bin/java -ea -cp $XTREEMFS/src/servers/dist/XtreemFS.jar:$XTREEMFS/src/servers/lib/*:/usr/share/java/XtreemFS.jar:. \
    org.xtreemfs.common.clients.simplescrubber.Scrubber $*
