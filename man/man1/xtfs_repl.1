.TH xtfs_repl 1 "July 2009" "The XtreemFS Distributed File System" "XtreemFS tools"
.SH NAME
xtfs_repl \- tool for the management of file replicas.
.SH SYNOPSIS
\fBxtfs_repl [ \fIoptions\fB ] <file>
.br

.SH DESCRIPTION
.I xtfs_repl
adds, removes and lists replicas of a given file.

.SH EXAMPLE USAGE
.B "xtfs_repl --set_readonly --auto_add dns xtreemfs/file.txt"
.PP
Marks the file 'xtreemfs/file.txt' as read-only and automatically adds a new replica to the file, provided that the path refers to a file in a mounted XtreemFS volume. OSDs for the new replica are automatically selected, as close to the client as possible.

.SH OPTIONS
.TP
.TP
\fB-a \fI<UUID_of_OSD1 UUID_of_OSD2 ...>
Adds a replica from the given space-separated list of OSDs. Since the replica will be assigned the same striping policy as the original file, the number of OSDs must match the number of OSDs in the original file's striping policy.
.TP
\fB-c \fI<creds_file>
a PKCS#12 file containing user credentials for SSL-based server connections
.TP
\fB-cpass \fI<creds_passphrase>
a pass phrase to decrypt the the user credentials file for SSL-based server connections
.TP
\fB-h/--help
show usage info
.TP
\fB-l
lists all replicas of the given file
.TP
\fB-o
Lists all suitable OSDs that can be used for a new replica of the given file. OSDs that are already assigned other replicas of the file will be automatically excluded from the list.
.TP
\fB-r \fI<UUID_of_head-OSD>
Removes the replica with the given head OSD. The head OSD is the first OSD in the OSD list of a replica.
.TP
\fB-t \fI<trusted_CAs>
a PKCS#12 file containing a set of certificates from trusted CAs for SSL-based server connections
.TP
\fB-tpass \fI<trusted_passphrase>
a pass phrase to decrypt the trusted CAs file for SSL-based server connections
.TP
\fB-w \fI<#OSDs>
specifies the number of OSDs to be used for this replica (i.e. stripe width)
.TP
\fB--add_auto \fIrandom|dns
Adds a replica and automatically selects OSDs according to the chosen method. The \fIrandom\fP method selects a random subset of all available OSDs for the new replica. The \fIdns\fP method selects those OSDs that are closest to the machine at which this command is executed.
.TP
\fB--full
if set, the replica will be a complete copy of the file; otherwise only requested data will be replicated
.TP
\fB--ocr_factor_set \fI<number>
Adjusts the number of replicas assigned to a file when the file is closed after a write. A value of 1 indicates that no replicas will be added and the file remains writable.
.TP
\fB--ocr_factor_get
shows the current on-close replication factor
.TP
\fB--ocr_full_set \fItrue | false
sets whether full replicas will be created when on-close replication is in effect
.TP
\fB--ocr_full_get
shows whether full replicas will be created by means of the on-close replication mechanism
.TP
\fB--pol_attrs_get
shows all policy-specific attributes
.TP
\fB--pol_attr_set \fI<name=value>
Sets a policy-specific attribute. Policy-specific attributes can be used to configure OSD and replica selection policies.

The following attributes will be recognized by the predefined policies (policy IDs in brackets):
  \fIdomains\fP (1001) - a list of comma or space-separated domain names, one of which an OSD must be in to be regarded as suitable for a new file or replica
  \fIfree_capacity_bytes\fP (1000) - the minimum free capacity in bytes an OSD must have to be regarded as suitable for a new file or replica
  \fIoffline_time_secs\fP (1000) - the maximum time in seconds an OSD may have failed to send a heartbeat signal in order to be regarded as suitable for a new file or replica
.TP
\fB--osp_get
shows the volume's current list of OSD selection policies
.TP
\fB--osp_set \fIdefault | fqdn | dcmap | <policy_ID, [policy_ID, ...]>
Sets a list of successively applied OSD selection policies. OSD selection policies are used to select subsets among all known OSDs that are assigned to newly created files and replicas. \fIdefault\fP, \fIfqdn\fP and \fIdcmap\fP are pre-packaged policies that select OSDs randomly, based on their host's FQDNs, and based on a data center map, accordingly.

The following policies are available by default:
  \fI1000\fP - filter out dead OSDs and OSDs that do not have sufficient space
  \fI1001\fP - filter out OSDs with FQDNs that do not match a given set of domains
  \fI2000\fP - select a group of OSDs according to a data center map
  \fI2001\fP - select the group of OSDs that provides enough OSDs, is in the same domain, and is closest to the client
.TP
\fB--remove_auto
removes a randomly selected replica from the given file
.TP
\fB--rsp_get
shows the volume's current list of replica selection policies
.TP
\fB--rsp_set \fIdefault | fqdn | dcmap | <policy_ID, [policy_ID, ...]>
Sets a list of successively applied replica selection policies. Replica selection policies are used to define the order in which the client will attempt to access the replicas of a file. The client will first try to access the first replica, and - in case of a failed attempt - the next one, and so on. Replica selection policies can e.g. be used to make sure that clients will always attempt to access local replicas first. \fIdefault\fP, \fIfqdn\fP and \fIdcmap\fP are pre-packaged policies that do not reorder the list at all, reorder it based on the distance between the client's and OSD host's FQDN, and based on a data center map, accordingly.

The following policies are available by default:
  \fI3000\fP - randomly shuffles the list of OSDs
  \fI3001\fP - sorts the list of OSDs in the order of their distance to the client, according to the data center map
  \fI3002\fP - sorts the list of OSDs in the order of their distances between the hosts' FQDNs and the client's FQDN
.TP
\fB--set_readonly
Marks the file as read-only. Having marked the file as read-only will effect that any kind of write access to the file will be denied in the future. Marking a file as read-only is a prerequisite for adding new replicas to the file.
.TP
\fB--set_writeable
Revokes the read-only status of a file. This is only possible as long as the file has no more than a single replica. 
.TP
\fB--strategy \fIrandom|sequential
EXPERIMENTAL - specifies the strategy for data transfers that are initiated between OSDs in order to stream data between replicas

.SH "SEE ALSO"
.BR xtfs_cleanup (1),
.BR xtfs_lsvol (1),
.BR xtfs_mkvol (1),
.BR xtfs_mount (1),
.BR xtfs_mrcdbtool (1),
.BR xtfs_rmvol (1),
.BR xtfs_scrub (1),
.BR xtfs_sp (1),
.BR xtfs_stat (1),
.BR xtfs_umount (1)
.BR

.SH AVAILABILITY
The xtfs_mrcdbtool command is part of the XtreemFS-tools package and is available from http://www.xtreemfs.org
